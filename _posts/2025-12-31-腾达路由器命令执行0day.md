---
layout:     post
title:      自挖掘漏洞_腾达路由器命令执行0day漏洞
subtitle:  关于最新的can指令传输防御机制（伪造协议包）
date:       2024-03-03
author:     BY kexiaohei
header-img: img/%E8%85%BE%E8%BE%BE%E8%B7%AF%E7%94%B1%E5%99%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C0day.assets/back.jpg
catalog: true
tags:
    - 0day
    - 路由器
    - router
    - 命令执行
---

# 自挖掘漏洞_腾达路由器命令执行0day漏洞



***

产家：腾达 （Tenda）

版本号：V1.2.0.14(408)

产品：路由器

系统：mips

漏洞程序：/bin/httpd

漏洞类型：命令执行

***

## 0x01 模拟运行

​	首先是模拟起来，然后通过grep寻找拼接的url精准分析 （详细在路由器漏洞挖掘中看到）

![image-20221124180749641](../../../../img/%E8%85%BE%E8%BE%BE%E8%B7%AF%E7%94%B1%E5%99%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C0day.assets/image-20221124180749641.png)

这里直接就可以分析到/bin/httpd中，所以，这个就很简单确认了漏洞位置，然后直接从定位中，进行对目录下的接口进行分析，这次漏洞也不例外，直接可以从里面的调用进行分析，因此直接到httpd中的函数：formDefineTendDa中，这个里面都是集合的接口。



## 0x02 从漏洞函数进行分析

​		一开始我也没注意看集合的接口里面含有哪些，就是快速扫一眼，竟然没注意到最后的函数名称，实在是本次分析的遗憾点，不然会更快发现

![image-20221124181610902](../../../../img/%E8%85%BE%E8%BE%BE%E8%B7%AF%E7%94%B1%E5%99%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C0day.assets/image-20221124181610902.png)

我直接从import中确定system函数，在搜索中发现有两个函数是执行命令的：

![image-20221124181654095](../../../../img/%E8%85%BE%E8%BE%BE%E8%B7%AF%E7%94%B1%E5%99%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C0day.assets/image-20221124181654095.png)

后来我在system中没讨到好处，全是写死的命令

所以这里找到了doSystemCmd

然后根据一顿交叉引用，然后就到了formexeCommand函数中，而该函数调用就是在formDefineTendDa中，所以，直接通过构造url，http://192.168.0.1/goform/exeCommand 这里直接到formexeCommand分析了

![image-20221124190915104](../../../../img/%E8%85%BE%E8%BE%BE%E8%B7%AF%E7%94%B1%E5%99%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C0day.assets/image-20221124190915104.png)

## 0x03 函数调用

​		formexeCommand函数中明显就提到了，这个参数用get传输

​		![image-20221124191107069](../../../../img/%E8%85%BE%E8%BE%BE%E8%B7%AF%E7%94%B1%E5%99%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C0day.assets/image-20221124191107069.png)

这里可以看到调用在下面，所以直接先构造链接，发现命令执行成功：

![image-20221124191155756](../../../../img/%E8%85%BE%E8%BE%BE%E8%B7%AF%E7%94%B1%E5%99%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C0day.assets/image-20221124191155756.png)

![image-20221124191337992](../../../../img/%E8%85%BE%E8%BE%BE%E8%B7%AF%E7%94%B1%E5%99%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C0day.assets/image-20221124191337992.png)

![image-20221124191403719](../../../../img/%E8%85%BE%E8%BE%BE%E8%B7%AF%E7%94%B1%E5%99%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C0day.assets/image-20221124191403719.png)

